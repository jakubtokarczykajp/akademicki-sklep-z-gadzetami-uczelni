{% load i18n %}
{% load static %}
{% load currency_filters %}

{# Fragment używany w pętli do wyświetlania pojedynczego produktu #}
<div class="group relative bg-white rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300 border border-gray-100 overflow-hidden flex flex-col h-full"
     data-product-item data-id="{{ product.id }}" data-price="{{ product.stockrecords.first.price }}">

    {# Link i Zdjęcie #}
    <a href="{{ product.get_absolute_url }}" class="block aspect-[4/5] bg-gray-50 relative overflow-hidden p-6">
        <div class="absolute inset-0 bg-gradient-to-t from-black/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>

        {% if product.primary_image %}
            <img src="{{ product.primary_image.original.url }}"
                 alt="{{ product.title }}"
                                 class="max-h-full max-w-full object-contain">
        {% else %}
            <img src="{% static 'theme/images/placeholder.png' %}"
                 class="w-full h-full object-contain opacity-40 mix-blend-multiply p-4">
        {% endif %}

        {# Badge #}
        <span class="absolute top-3 left-3 bg-white/90 backdrop-blur text-xs font-bold px-2 py-1 rounded-md text-gray-800 shadow-sm">
            NOWOŚĆ
        </span>
    </a>

    {# Treść #}
    <div class="p-5 flex-1 flex flex-col">
        <div class="mb-2">
            <p class="text-xs text-blue-500 font-semibold uppercase tracking-wide">
                {{ product.get_product_class.name }}
            </p>
        </div>

        <h3 class="text-lg font-bold text-gray-900 mb-2 leading-tight group-hover:text-[#015F8A] transition-colors">
            <a href="{{ product.get_absolute_url }}">
                {{ product.title|truncatechars:40 }}
            </a>
        </h3>

        <div class="mt-auto pt-4 flex items-center justify-between border-t border-gray-50">
            <div class="flex flex-col">
                <span class="text-xs text-gray-400">Cena</span>
                {% with price=product.get_base_price %}
                    {% if price and price.incl_tax %}
                        <span class="text-xl font-extrabold text-[#015F8A]">
                            {{ price.incl_tax|currency }}
                        </span>
                    {% else %}
                        <span class="text-sm font-medium text-red-500">Niedostępny</span>
                    {% endif %}
                {% endwith %}
            </div>

            {# Przycisk szybkiego dodawania - wywołuje JS addProductToBasket #}
            <button onclick="addProductToBasket(event)"
                    class="bg-gray-900 text-white w-10 h-10 rounded-full flex items-center justify-center hover:bg-[#015F8A] transform hover:scale-110 active:scale-95 transition-all shadow-md group/btn"
                    title="Dodaj do koszyka">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
            </button>
        </div>
    </div>
</div>